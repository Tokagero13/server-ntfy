# –ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `python-telegram-bot==20.7`.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≥—Ä—É–ø–ø—ã

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ ID –≥—Ä—É–ø–ø—ã:

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ [@userinfobot](https://t.me/userinfobot) –≤ –≥—Ä—É–ø–ø—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ, –≤–∫–ª—é—á–∞—è ID
4. ID –≥—Ä—É–ø–ø—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-1003075012272`)

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Ç–æ–ø–∏–∫–∞ (–¥–ª—è —Ñ–æ—Ä—É–º–Ω—ã—Ö –≥—Ä—É–ø–ø)

–ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–∞–∫ —Ñ–æ—Ä—É–º:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–π —Ç–æ–ø–∏–∫
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–ø–∏–∫
3. ID —Ç–æ–ø–∏–∫–∞ - —ç—Ç–æ —á–∏—Å–ª–æ –ø–æ—Å–ª–µ `_` –≤ —Å—Å—ã–ª–∫–µ
   - –ü—Ä–∏–º–µ—Ä: `https://t.me/c/1003075012272/1` ‚Üí ID —Ç–æ–ø–∏–∫–∞: `1`

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env`:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
TELEGRAM_BOT_TOKEN=8423537642:AAH4pSV9jblUNsH_uM-0XPppzHtQQ12e9nc

# –ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
TELEGRAM_GROUP_ENABLED=True
TELEGRAM_GROUP_CHAT_ID=-1003075012272
TELEGRAM_GROUP_THREAD_ID=1
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------------|--------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather | ‚úÖ | `8423537642:AAH...` |
| `TELEGRAM_GROUP_ENABLED` | –í–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | ‚úÖ | `True` |
| `TELEGRAM_GROUP_CHAT_ID` | ID –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π) | ‚úÖ | `-1003075012272` |
| `TELEGRAM_GROUP_THREAD_ID` | ID —Ç–æ–ø–∏–∫–∞ –¥–ª—è —Ñ–æ—Ä—É–º–Ω—ã—Ö –≥—Ä—É–ø–ø | ‚ùå | `1` |

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph LR
    A[–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞] --> B[send_notifications]
    B --> C[NTFY]
    B --> D[Individual Telegram]
    B --> E[Group Notifications]
    
    E --> F[TelegramGroupNotifier]
    F --> G[python-telegram-bot 20.7]
    G --> H[–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç]
    G --> I[–¢–æ–ø–∏–∫ –≤ —Ñ–æ—Ä—É–º–µ]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **`group_notifications.py`** - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å —Å –∫–ª–∞—Å—Å–æ–º `TelegramGroupNotifier`
2. **`notifications.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥—Ä—É–ø–ø–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **`config.py`** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîß API

### –ö–ª–∞—Å—Å TelegramGroupNotifier

```python
from app.core.group_notifications import TelegramGroupNotifier

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
notifier = TelegramGroupNotifier(
    bot_token="YOUR_BOT_TOKEN",
    chat_id="-1003075012272",
    thread_id="1"  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
)

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
success = notifier.send_message("–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")

# –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
is_connected = notifier.test_connection()
```

### –§—É–Ω–∫—Ü–∏—è send_group_notification

```python
from app.core.group_notifications import send_group_notification

success = send_group_notification(
    bot_token="YOUR_BOT_TOKEN",
    chat_id="-1003075012272",
    message="–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ",
    endpoint_url="https://api.example.com/health",
    thread_id="1"  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
)
```

## üì® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

–ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å:

- üîî –≠–º–æ–¥–∑–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
- **–ñ–∏—Ä–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º**
- HTML —Ä–∞–∑–º–µ—Ç–∫–æ–π
- –°—Å—ã–ª–∫–æ–π –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç

### –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è

```
üîî –ì—Ä—É–ø–ø–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

‚ùå –≠–Ω–¥–ø–æ–∏–Ω—Ç https://api.example.com/health –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
–°—Ç–∞—Ç—É—Å: 500 Internal Server Error
–í—Ä–µ–º—è: 2024-12-12 12:25:43 UTC

üîó https://api.example.com/health
```

## üö¶ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

–ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏—é `send_notifications()`:

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:
# - NTFY (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
# - Individual Telegram (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
# - Group Telegram (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)

from app.core.notifications import send_notifications

send_notifications(
    message="–≠–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω",
    endpoint_url="https://api.example.com/health",
    endpoint_id=1
)
```

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç:

- ‚úÖ –£—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- üìä –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤

```
INFO:app.core.group_notifications:Group notification sent to chat_id -1003075012272 (thread 1): üîî –ì—Ä—É–ø–ø–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...
INFO:app.core.notifications:Notification dispatch complete: NTFY: ‚úì | Telegram: ‚úì | Group: ‚úì
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞:**
   - –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É?
   - –£ –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π?

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - `TELEGRAM_GROUP_CHAT_ID` –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π?
   - `TELEGRAM_BOT_TOKEN` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π?

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–ø–∏–∫:**
   - –¢–æ–ø–∏–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
   - ID —Ç–æ–ø–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π?

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```python
from app.core.group_notifications import TelegramGroupNotifier

notifier = TelegramGroupNotifier(
    bot_token="YOUR_BOT_TOKEN",
    chat_id="-1003075012272"
)

if notifier.test_connection():
    print("‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!")
else:
    print("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `Chat not found` | –ù–µ–≤–µ—Ä–Ω—ã–π ID —á–∞—Ç–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≥—Ä—É–ø–ø—ã |
| `Bot was blocked` | –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω | –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ |
| `Topic not found` | –ù–µ–≤–µ—Ä–Ω—ã–π ID —Ç–æ–ø–∏–∫–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID —Ç–æ–ø–∏–∫–∞ |
| `Forbidden` | –ù–µ—Ç –ø—Ä–∞–≤ | –î–∞–π—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |

## üì± –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```env
TELEGRAM_BOT_TOKEN=8423537642:AAH4pSV9jblUNsH_uM-0XPppzHtQQ12e9nc
TELEGRAM_GROUP_ENABLED=True
TELEGRAM_GROUP_CHAT_ID=-1003075012272
```

### –§–æ—Ä—É–º–Ω–∞—è –≥—Ä—É–ø–ø–∞ —Å —Ç–æ–ø–∏–∫–æ–º

```env
TELEGRAM_BOT_TOKEN=8423537642:AAH4pSV9jblUNsH_uM-0XPppzHtQQ12e9nc
TELEGRAM_GROUP_ENABLED=True
TELEGRAM_GROUP_CHAT_ID=-1003075012272
TELEGRAM_GROUP_THREAD_ID=1
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```env
TELEGRAM_GROUP_ENABLED=False
```

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [python-telegram-bot –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python-telegram-bot.org/)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [@BotFather](https://t.me/BotFather) - —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–æ–≤
- [@userinfobot](https://t.me/userinfobot) - –ø–æ–ª—É—á–µ–Ω–∏–µ ID —á–∞—Ç–æ–≤